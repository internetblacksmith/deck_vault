<%
  quantity = card.collection_card&.quantity.to_i
  foil_quantity = card.collection_card&.foil_quantity.to_i
  is_owned = quantity > 0 || foil_quantity > 0
  total_owned = quantity + foil_quantity
%>
<%= turbo_frame_tag "binder-card-#{card.id}" do %>
  <div data-card-id="<%= card.id %>" 
       data-controller="card-update" 
       style="position:relative;border-radius:4px;overflow:hidden;background:#222;<%= 'opacity:0.35;' unless is_owned %>"
       title="<%= card.name %> (#<%= card.collector_number %>)<%= " - Regular: #{quantity}, Foil: #{foil_quantity}" if is_owned %>">
    <% if card.image_path.present? %>
      <img src="/<%= card.image_path %>" alt="<%= card.name %>" style="width:100%;height:auto;display:block;<%= 'filter:grayscale(100%);' unless is_owned %>" onerror="this.src='/card_placeholder.webp'">
    <% else %>
      <img src="/card_placeholder.webp" alt="<%= card.name %>" style="width:100%;height:auto;display:block;<%= 'filter:grayscale(100%);' unless is_owned %>">
    <% end %>
    
    <% if is_owned %>
      <div style="position:absolute;top:4px;right:4px;display:flex;gap:2px;">
        <% if quantity > 0 %>
          <div style="background:rgba(0,0,0,0.8);color:#4f8;padding:2px 6px;border-radius:3px;font-size:11px;font-weight:600;">
            x<%= quantity %>
          </div>
        <% end %>
        <% if foil_quantity > 0 %>
          <div style="background:linear-gradient(135deg, rgba(80,60,120,0.9) 0%, rgba(40,30,80,0.9) 100%);color:#c9f;padding:2px 6px;border-radius:3px;font-size:11px;font-weight:600;">
            x<%= foil_quantity %>
          </div>
        <% end %>
      </div>
    <% end %>
    
    <!-- Card number badge -->
    <div style="position:absolute;bottom:4px;left:4px;background:rgba(0,0,0,0.8);color:<%= is_owned ? '#fff' : '#666' %>;padding:2px 6px;border-radius:3px;font-size:10px;">
      #<%= card.collector_number %>
    </div>

    <input type="hidden" data-card-update-target="quantity" value="<%= quantity %>" data-card-id="<%= card.id %>">
    <input type="hidden" data-card-update-target="foilQuantity" value="<%= foil_quantity %>" data-card-id="<%= card.id %>">
    <input type="hidden" data-card-update-target="notes" value="<%= card.collection_card&.notes || '' %>" data-card-id="<%= card.id %>">
  </div>
<% end %>
